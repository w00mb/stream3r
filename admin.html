<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin</title>

  <!-- Core styles -->
  <link rel="stylesheet" href="/styles.css" />

  <!-- HTMX for partial-loading -->
  <script src="/public/htmx.min.js" defer></script>
</head>
<body class="Site">
  <header class="Site-header">
    <div class="container-xl d-flex flex-justify-between flex-items-center">
      <a class="brand text-semibold f3" href="/">Your Project Name</a>
      <nav class="d-flex gap-2">
        <a class="Button Button--invisible size-small" href="/">View site</a>
      </nav>
    </div>
  </header>

  <!-- Theme tokens injected from DB (so admin reflects live theme) -->
  <div hx-get="/partials/tokens" hx-trigger="load" hx-swap="outerHTML"></div>

  <main class="Site-main">
    <div class="container-xl">
      <!-- Tabs -->
      <nav class="tab-nav d-flex gap-2 mb-3 flex-justify-end" aria-label="Admin tabs">
        <button class="Button Button--invisible"
                hx-get="/partials/admin/tab-design"
                hx-target="#admin-tab-body"
                hx-swap="innerHTML">
          Design
        </button>
        <button class="Button Button--invisible"
                hx-get="/partials/admin/tab-bio"
                hx-target="#admin-tab-body"
                hx-swap="innerHTML">
          Bio
        </button>
        <button class="Button Button--invisible"
                hx-get="/partials/admin/tab-calender"
                hx-target="#admin-tab-body"
                hx-swap="innerHTML">
          Calendar
        </button>
        <button class="Button Button--invisible"
                hx-get="/partials/admin/tab-metrics"
                hx-target="#admin-tab-body"
                hx-swap="innerHTML">
          Metrics
        </button>
        <button class="Button Button--invisible"
                hx-get="/partials/admin/tab-feed"
                hx-target="#admin-tab-body"
                hx-swap="innerHTML">
          Feed
        </button>
      </nav>

      <!-- Tab body -->
      <section id="admin-tab-body" class="Card p-2">
        <div class="color-fg-muted">Select a tabâ€¦</div>
      </section>

      <!-- Optional: autoload first tab on page load -->
      <div class="sr-only"
           hx-get="/partials/admin/tab-design"
           hx-trigger="load"
           hx-target="#admin-tab-body"
           hx-swap="innerHTML"></div>
    </div>
  </main>

  <footer class="Site-footer">
    <div class="container-xl color-fg-muted">
      <small>Admin</small>
    </div>
  </footer>

  <script>
    // Minimal analytics for admin too
    (function () {
      const start = performance.now();
      const path = location.pathname + location.search;
      const title = document.title;
      const referrer = document.referrer;

      function send(event, extra) {
        const payload = {
          event, path, title, referrer,
          ...(extra || {})
        };
        const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
        if (!navigator.sendBeacon || !navigator.sendBeacon('/api/track', blob)) {
          fetch('/api/track', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload), keepalive: true });
        }
      }

      send('pageview');

      let flushed = false;
      function flushDwell() {
        if (flushed) return;
        flushed = true;
        const dwell_ms = Math.round(performance.now() - start);
        send('dwell', { dwell_ms });
      }
      addEventListener('visibilitychange', () => { if (document.visibilityState === 'hidden') flushDwell(); });
      addEventListener('pagehide', flushDwell);
      addEventListener('beforeunload', flushDwell);
    })();
  </script>
</body>
</html>
